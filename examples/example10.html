<!DOCTYPE html> 
<html>
  <head>
    <script src="../jaws-dynamic.js"></script>
    <script src="../game_states/edit.js"></script>
    <link type="text/css" rel="stylesheet" href="style.css" />
    <title>Jaws Example #9 - game state Edit</title>
  </head>
<body>

  <canvas width=500 height=400></canvas>

  <div id="jaws-edit" />Editor output will show here.</div>
  
  <div id="info">
    <h1>Edit</h1>
    SPACE: start editor. ESC: exit editor. S: Save sprite-properties to localStorage. +: Adds new object<br/><br />
    <code>
    game_state = new jaws.game_states.Edit({game_objects: blocks, grid_size: [32,32]});<br />
    jaws.switchGameState(game_state);
    </code>
    <br /><br />
    Click and drag to move sprites. Hold CTRL to select more then one. If you save with 'S' you can refresh browser and sprites will be loaded from localStorage.
  </div>
  
  <h3>jaws log</h3>
  <div id="jaws-log"></div>
 
  <script>
    function Example() {
      var blocks = new jaws.SpriteList()
      var title = window.location.href  // Use URL as unique identifier when saving/fetching game objects from localStorage
     
      this.setup = function() {
        blocks.load(localStorage[title])  // Try to load  saved sprites from localStorage
        if(blocks.length == 0) {          // No sprites in localStorage? Generate 5 randomly placed blocks!
          for(var nr=5; nr--; ) {
            blocks.push( new jaws.Sprite({image: "block.bmp", x: Math.random()*jaws.width, y: Math.random()*jaws.height}) )
          }
        }
 
        jaws.on_keydown(["esc","space"], function() { 
          // Start editor by switching game state to a new isntance of jaws.game_states.Edit
          jaws.switchGameState( new jaws.game_states.Edit({game_objects: blocks, grid_size: [32,32], title: title}) )
        })
        jaws.preventDefaultKeys(["space"])
      }
      
      this.draw = function() {
        jaws.clear()
        blocks.draw()
      }
    }

    /* Entry point after jaws is done loading */
    jaws.onload = function() {
      // jaws.assets.add("block.bmp") // Uncomment to preload block.bmp
      // Without preload, a sprite using "block.bmp" will try to load it creation time
      jaws.start(Example)
    }
  </script>

</body>
</html>

