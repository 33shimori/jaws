var jaws=function(b){var c,d;b.__defineSetter__("title",function(f){c.innerHTML=f});b.__defineGetter__("title",function(){return c.innerHTML});b.__defineGetter__("width",function(){return b.canvas?b.canvas.width:b.dom.offsetWidth});b.__defineGetter__("height",function(){return b.canvas?b.canvas.height:b.dom.offsetHeight});b.unpack=function(){["Sprite","SpriteList","Animation","Viewport","SpriteSheet","Parallax","Rect","Array"].forEach(function(f){if(window[f])b.debug(f+"already exists in global namespace");
else window[f]=b[f]})};b.debug=function(f,j){if(d){f+="<br />";d.innerHTML=j?d.innerHTML.toString()+f:f}};b.init=function(){c=document.getElementsByTagName("title")[0];for(var f=b,j=[],e,h=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<h.length;g++){e=h[g].split("=");j.push(e[0]);j[e[0]]=e[1]}f.url_parameters=j;d=document.getElementById("jaws-debug");if(b.url_parameters.debug)if(!d){d=document.createElement("div");d.style.cssText="overflow: auto; color: #aaaaaa; width: 300px; height: 150px; margin: 40px auto 0px auto; padding: 5px; border: #444444 1px solid; clear: both; font: 10px verdana; text-align: left;";
document.body.appendChild(d)}b.canvas=document.getElementsByTagName("canvas")[0];if(b.canvas)b.context=b.canvas.getContext("2d");else{b.dom=document.getElementById("canvas");b.dom.style.position="relative"}};b.start=function(f,j){function e(o,p){b.debug(p+"%: "+o,true)}function h(){b.debug("all assets loaded",true);b.gameloop=new b.GameLoop(k,m,l,n);b.gameloop.start()}var g=f?f:{};if(b.isFunction(g))g=new g;var k=g.setup||window.setup,m=g.update||window.update,l=g.draw||window.draw,n=g.fps||parseInt(j)||
60;b.init(g);b.debug("setupInput()",true);b.setupInput();b.debug("assets.loadAll()",true);b.assets.length()>0?b.assets.loadAll({loading:e,loaded:h}):h()};b.switchGameState=function(f){b.gameloop.stop();on_keydown_callbacks=[];on_keyup_callbacks=[];if(b.isFunction(f))f=new f;b.previous_game_state=f;b.game_state=f;b.gameloop=new b.GameLoop(f.setup,f.update,f.draw,b.gameloop.fps);b.gameloop.start()};b.isImage=function(f){return Object.prototype.toString.call(f)==="[object HTMLImageElement]"};b.isCanvas=
function(f){return Object.prototype.toString.call(f)==="[object HTMLCanvasElement]"};b.isDrawable=function(f){return b.isImage(f)||b.isCanvas(f)};b.isString=function(f){return typeof f=="string"};b.isArray=function(f){return f.constructor.toString().indexOf("Array")!=-1};b.isFunction=function(f){return Object.prototype.toString.call(f)==="[object Function]"};b.combinations=function(f,j){for(var e=function(l){return f[l]},h=[],g=Array(j),k=0;k<j;k++)g[k]=k;k=j-1;for(var m=f.length;0<=k;m=f.length){for(h.push(g.map(e));0<=
k&&g[k]==m-1;){k--;m--}if(0<=k){g[k]+=1;for(k=k+1;k<j;k++)g[k]=g[k-1]+1;k=j-1}}return h};return b}(jaws||{});
jaws=function(b){var c={},d=[],f=[];b.setupInput=function(){var e=[];e[8]="backspace";e[9]="tab";e[13]="enter";e[16]="shift";e[17]="ctrl";e[18]="alt";e[19]="pause";e[20]="capslock";e[27]="esc";e[32]="space";e[33]="pageup";e[34]="pagedown";e[35]="end";e[36]="home";e[37]="left";e[38]="up";e[39]="right";e[40]="down";e[45]="insert";e[46]="delete";e[91]="leftwindowkey";e[92]="rightwindowkey";e[93]="selectkey";e[106]="multiply";e[107]="add";e[109]="subtract";e[110]="decimalpoint";e[111]="divide";e[144]=
"numlock";e[145]="scrollock";e[186]="semicolon";e[187]="equalsign";e[188]="comma";e[189]="dash";e[190]="period";e[191]="forwardslash";e[192]="graveaccent";e[219]="openbracket";e[220]="backslash";e[221]="closebracket";e[222]="singlequote";for(var h=["numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9"],g=["f1","f2","f3","f4","f5","f6","f7","f8","f9"],k=["1","2","3","4","5","6","7","8","9"],m=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r",
"s","t","u","v","w","x","y","z"],l=0;k[l];l++)e[48+l]=k[l];for(l=0;m[l];l++)e[65+l]=m[l];for(l=0;h[l];l++)e[96+l]=h[l];for(l=0;g[l];l++)e[112+l]=g[l];this.keycode_to_string=e;window.onkeydown=function(n){b.handleKeyDown(n)};window.onkeyup=function(n){b.handleKeyUp(n)};window.onkeypress=function(){}};b.handleKeyUp=function(e){event=e?e:window.event;var h=this.keycode_to_string[event.keyCode];c[h]=false;if(f[h]){f[h]();e.preventDefault()}j[h]&&e.preventDefault()};b.handleKeyDown=function(e){event=e?
e:window.event;var h=this.keycode_to_string[event.keyCode];c[h]=true;if(d[h]){d[h]();e.preventDefault()}j[h]&&e.preventDefault()};var j=[];b.preventDefaultKeys=function(e){e.forEach(function(h){j[h]=true})};b.pressed=function(e){return c[e]};b.on_keydown=function(e,h){if(b.isArray(e))for(var g=0;e[g];g++)d[e[g]]=h;else d[e]=h};b.on_keyup=function(e,h){if(b.isArray(e))for(var g=0;e[g];g++)f[e[g]]=h;else f[e]=h};return b}(jaws||{});
jaws=function(b){Asset=function(){this.list=[];this.data=[];c=this;this.file_type={};this.file_type.wav="audio";this.file_type.mp3="audio";this.file_type.ogg="audio";this.file_type.png="image";this.file_type.jpg="image";this.file_type.jpeg="image";this.file_type.bmp="image";var c=this;this.length=function(){return this.list.length};this.add=function(d){this.list.push({src:d});return this};this.get=function(d){return b.isArray(d)?d.map(function(f){return c.data[f]}):this.data[d]};this.getType=function(d){postfix_regexp=
/\.([a-zA-Z]+)/;postfix=postfix_regexp.exec(d)[1];return this.file_type[postfix]?this.file_type[postfix]:postfix};this.loadAll=function(d){this.loadedCount=0;if(d){this.loaded_callback=d.loaded;this.loading_callback=d.loading}for(i=0;this.list[i];i++){d=this.list[i];switch(this.getType(d.src)){case "image":var f=d.src+"?"+parseInt(Math.random()*1E7);d.image=new Image;d.image.asset=d;d.image.onload=this.imageLoaded;d.image.src=f;break;case "audio":f=d.src+"?"+parseInt(Math.random()*1E7);d.audio=new Audio(f);
d.audio.asset=d;this.data[d.src]=d.audio;d.audio.addEventListener("canplay",this.audioLoaded,false);d.audio.load();break;default:f=d.src+"?"+parseInt(Math.random()*1E7);var j=new XMLHttpRequest;j.open("GET",f,false);j.send(null);if(j.status==200){this.data[d.src]=this.parseAsset(d.src,j.responseText);this.itemLoaded(d.src)}}}};this.parseAsset=function(d,f){switch(this.getType(d)){case "json":return JSON.parse(f);default:return f}};this.itemLoaded=function(d){this.loadedCount++;var f=parseInt(this.loadedCount/
this.list.length*100);this.loading_callback&&this.loading_callback(d,f);this.loaded_callback&&f==100&&this.loaded_callback()};this.imageLoaded=function(){var d=this.asset;c.data[d.src]=d.image;c.itemLoaded(d.src)};this.audioLoaded=function(){var d=this.asset;c.data[d.src]=d.audio;d.audio.removeEventListener("canplay",c.audioLoaded,false);c.itemLoaded(d.src)}};b.assets=new Asset;return b}(jaws||{});
jaws=function(b){b.GameLoop=function(c,d,f,j){this.fps=this.tick_duration=this.ticks=0;var e,h=false,g=this;this.start=function(){b.debug("gameloop start",true);this.current_tick=(new Date).getTime();this.last_tick=(new Date).getTime();c&&c();e=setInterval(this.loop,1E3/j);b.debug("gameloop loop",true)};this.loop=function(){g.current_tick=(new Date).getTime();g.tick_duration=g.current_tick-g.last_tick;g.fps=parseInt(1E3/g.tick_duration);if(!h){d&&d();f&&f();g.ticks++}g.last_tick=g.current_tick};this.pause=
function(){h=true};this.unpause=function(){h=false};this.stop=function(){e&&clearInterval(e)}};return b}(jaws||{});
jaws=function(b){b.Rect=function(c,d,f,j){this.x=c;this.y=d;this.width=f;this.height=j;this.__defineGetter__("right",function(){return this.x+this.width});this.__defineGetter__("bottom",function(){return this.y+this.height});this.draw=function(){b.context.strokeStyle="red";b.context.strokeRect(this.x,this.y,this.width,this.height)};this.collidePoint=function(e,h){return e>=this.x&&e<=this.right&&h>=this.y&&h<=this.bottom};this.collideRect=function(e){return(this.x>=e.x&&this.x<=e.right||e.x>=this.x&&
e.x<=this.right)&&(this.y>=e.y&&this.y<=e.bottom||e.y>=this.y&&e.y<=this.bottom)}};b.Rect.prototype.collideRightSide=function(c){return this.right>=c.x&&this.x<c.x};b.Rect.prototype.collideLeftSide=function(c){return this.x>c.x&&this.x<=c.right};b.Rect.prototype.collideTopSide=function(c){return this.y>=c.y&&this.y<=c.bottom};b.Rect.prototype.collideBottomSide=function(c){return this.bottom>=c.y&&this.y<c.y};return b}(jaws||{});
jaws=function(b){b.Sprite=function(c){this.options=c;this.x=c.x||0;this.y=c.y||0;this.alpha=c.alpha||1;this.context=c.context||b.context;this.anchor_x=c.anchor_x||0;this.anchor_y=c.anchor_y||0;this.angle=c.angle||0;this.flipped=c.flipped||false;this._scale=c.scale||1;this._rect=new b.Rect(0,0,0,0);this.__defineGetter__("width",function(){return this._width});this.__defineGetter__("height",function(){return this._height});this.__defineGetter__("left",function(){return this.x-this.left_offset});this.__defineGetter__("top",
function(){return this.y-this.top_offset});this.__defineGetter__("right",function(){return this.x+this.right_offset});this.__defineGetter__("bottom",function(){return this.y+this.bottom_offset});this.calcBorderOffsets=function(){this._width=this._image.width*this._scale;this._height=this._image.height*this._scale;this.left_offset=this.width*this.anchor_x;this.top_offset=this.height*this.anchor_y;this.right_offset=this.width*(1-this.anchor_x);this.bottom_offset=this.height*(1-this.anchor_y)};this.__defineGetter__("image",
function(){return this._image});this.__defineSetter__("image",function(d){this._image=b.isDrawable(d)?d:b.assets.data[d];this.calcBorderOffsets()});this.__defineGetter__("scale",function(){return this._scale});this.__defineSetter__("scale",function(d){this._scale=d;this.calcBorderOffsets()});c.image&&(this.image=c.image);c.anchor&&this.anchor(c.anchor);this.__defineGetter__("rect",function(){this._rect.x=this.left;this._rect.y=this.top;this._rect.width=this.width;this._rect.height=this.height;return this._rect});
this.context||this.createDiv()};b.Sprite.prototype.createDiv=function(){this.div=document.createElement("div");this.div.style.position="absolute";this.div.style.width=this.image.width+"px";this.div.style.height=this.image.height+"px";this.div.style.backgroundImage="url("+this.image.src+")";b.dom&&b.dom.appendChild(this.div);this.updateDiv()};b.Sprite.prototype.updateDiv=function(){this.div.style.left=this.x+"px";this.div.style.top=this.y+"px";var c="";c+="rotate("+this.angle+"deg) ";if(this.flipped)c+=
"scale(-"+this.scale+","+this.scale+")";else if(this.scale!=1)c+="scale("+this.scale+")";this.div.style.MozTransform=c;this.div.style.WebkitTransform=c;this.div.style.transform=c};b.Sprite.prototype.draw=function(){if(b.dom)return this.updateDiv();this.context.save();this.context.translate(this.x,this.y);this.angle&&b.context.rotate(this.angle*Math.PI/180);this.flipped&&this.context.scale(-1,1);this.context.globalAlpha=this.alpha;this.context.translate(-this.left_offset,-this.top_offset);this.context.drawImage(this._image,
0,0,this._width,this._height);this.context.restore();return this};b.Sprite.prototype.asCanvasContext=function(){var c=document.createElement("canvas");c.width=this.width;c.height=this.height;c=c.getContext("2d");c.mozImageSmoothingEnabled=b.context.mozImageSmoothingEnabled;c.drawImage(this._image,0,0,this.width,this.height);return c};b.Sprite.prototype.rotate=function(c){this.angle+=c;return this};b.Sprite.prototype.anchor=function(c){if(a={top_left:[0,0],left_top:[0,0],center_left:[0,0.5],left_center:[0,
0.5],bottom_left:[0,1],left_bottom:[0,1],top_center:[0.5,0],center_top:[0.5,0],center_center:[0.5,0.5],center:[0.5,0.5],bottom_center:[0.5,1],center_bottom:[0.5,1],top_right:[1,0],right_top:[1,0],center_right:[1,0.5],right_center:[1,0.5],bottom_right:[1,1],right_bottom:[1,1]}[c]){this.anchor_x=a[0];this.anchor_y=a[1];this._image&&this.calcBorderOffsets()}return this};return b}(jaws||{});
jaws=function(b){b.SpriteList=function(){};b.SpriteList.prototype=[];b.SpriteList.prototype.draw=function(){for(i=0;this[i];i++)this[i].draw()};b.SpriteList.prototype.drawIf=function(c){for(i=0;this[i];i++)c(this[i])&&this[i].draw()};b.SpriteList.prototype.update=function(){for(i=0;this[i];i++)this[i].update()};b.SpriteList.prototype.updateIf=function(c){for(i=0;this[i];i++)c(this[i])&&this[i].update()};b.SpriteList.prototype.deleteIf=function(c){for(var d=0;this[d];d++)c(this[d])&&this.splice(d,
1)};return b}(jaws||{});
jaws=function(b){function c(d,f,j,e,h){var g=document.createElement("canvas");g.width=e;g.height=h;g.getContext("2d").drawImage(d,f,j,e,h,0,0,g.width,g.height);return g}b.SpriteSheet=function(d){this.image=b.isImage(d.image)?d.image:b.assets.data[d.image];this.orientation=d.orientation||"right";this.frame_size=d.frame_size||[32,32];this.frames=[];for(d=0;d<this.image.width;d+=this.frame_size[0])for(var f=0;f<this.image.height;f+=this.frame_size[1])this.frames.push(c(this.image,d,f,this.frame_size[0],
this.frame_size[1]));this.__defineGetter__("length",function(){return this.frames.length})};return b}(jaws||{});
jaws=function(b){b.Parallax=function(c){this.scale=c.scale||1;this.repeat_x=c.repeat_x;this.repeat_y=c.repeat_y;this.camera_x=c.camera_x||0;this.camera_y=c.camera_y||0;this.layers=[]};b.Parallax.prototype.draw=function(){for(var c,d,f,j=0;j<this.layers.length;j++){c=this.layers[j];d=c.x;f=c.y;c.x=-(this.camera_x/c.damping);for(c.y=-(this.camera_y/c.damping);this.repeat_x&&c.x>0;)c.x-=c.image.width;for(;this.repeat_y&&c.y>0;)c.y-=c.image.width;for(;this.repeat_x&&c.x<b.width;){for(;this.repeat_y&&
c.y<b.height;){c.draw();c.y+=c.image.height}c.y=f;c.draw();c.x+=c.image.width-1}for(;c.repeat_y&&!c.repeat_x&&c.y<b.height;){c.draw();c.y+=c.image.height}c.x=d}};b.Parallax.prototype.addLayer=function(c){c=new b.ParallaxLayer(c);c.scale=this.scale;this.layers.push(c)};b.ParallaxLayer=function(c){this.damping=c.damping||0;b.Sprite.call(this,c)};b.ParallaxLayer.prototype=b.Sprite.prototype;return b}(jaws||{});
jaws=function(b){b.Animation=function(c){this.options=c;this.frames=c.frames||[];this.frame_duration=c.frame_duration||100;this.index=c.index||0;this.loop=c.loop||1;this.bounce=c.bounce||0;this.frame_direction=1;if(c.sprite_sheet){var d=b.isImage(c.sprite_sheet)?c.sprite_sheet:b.assets.get(c.sprite_sheet);this.frames=(new b.SpriteSheet({image:d,frame_size:c.frame_size})).frames}this.__defineGetter__("length",function(){return this.frames.length});this.current_tick=(new Date).getTime();this.last_tick=
(new Date).getTime();this.sum_tick=0};b.Animation.prototype.update=function(){this.current_tick=(new Date).getTime();this.sum_tick+=this.current_tick-this.last_tick;this.last_tick=this.current_tick;if(this.sum_tick>this.frame_duration){this.index+=this.frame_direction;this.sum_tick=0}if(this.index>=this.frames.length||this.index<=0)if(this.bounce){this.frame_direction=-this.frame_direction;this.index+=this.frame_direction*2}else if(this.loop)this.index=0;return this};b.Animation.prototype.slice=function(c,
d){var f={};f.frame_duration=this.frame_duration;f.loop=this.loop;f.bounce=this.bounce;f.frame_direction=this.frame_direction;f.frames=this.frames.slice().slice(c,d);return new b.Animation(f)};b.Animation.prototype.next=function(){this.update();return this.frames[this.index]};b.Animation.prototype.currentFrame=function(){return this.frames[this.index]};return b}(jaws||{});
jaws=function(b){b.Viewport=function(c){this.options=c;this.context=c.context||b.context;this.width=c.width||b.canvas.width;this.height=c.height||b.canvas.height;this.max_x=c.max_x||b.canvas.width;this.max_y=c.max_y||b.canvas.height;this._x=c.x||0;this._y=c.y||0;this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y});this.__defineSetter__("x",function(d){this._x=d;d=this.max_x-this.width;if(this._x<0)this._x=0;if(this._x>d)this._x=d});this.__defineSetter__("y",
function(d){this._y=d;d=this.max_y-this.height;if(this._y<0)this._y=0;if(this._y>d)this._y=d});this.isOutside=function(d){return!this.isInside(d)};this.isInside=function(d){return d.x>=this._x&&d.x<=this._x+this.width&&d.y>=this._y&&d.y<=this._y+this.height};this.centerAround=function(d){this.x=d.x-this.width/2;this.y=d.y-this.height/2};this.apply=function(d){this.context.save();this.context.translate(-this._x,-this._y);d();this.context.restore()}};return b}(jaws||{});
