var jaws=function(b){var c,e;b.__defineSetter__("title",function(d){c.innerHTML=d});b.__defineGetter__("title",function(){return c.innerHTML});b.__defineGetter__("width",function(){return b.canvas?b.canvas.width:b.dom.offsetWidth});b.__defineGetter__("height",function(){return b.canvas?b.canvas.height:b.dom.offsetHeight});b.unpack=function(){["Sprite","SpriteList","Animation","Viewport","SpriteSheet","Parallax","Rect","Array","pressed"].forEach(function(d){if(window[d])b.debug(d+"already exists in global namespace");
else window[d]=b[d]})};b.debug=function(d,g){if(e){d+="<br />";e.innerHTML=g?e.innerHTML.toString()+d:d}};b.init=function(){c=document.getElementsByTagName("title")[0];for(var d=b,g=[],j,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),h=0;h<f.length;h++){j=f[h].split("=");g.push(j[0]);g[j[0]]=j[1]}d.url_parameters=g;e=document.getElementById("jaws-debug");if(b.url_parameters.debug)if(!e){e=document.createElement("div");e.style.cssText="overflow: auto; color: #aaaaaa; width: 300px; height: 150px; margin: 40px auto 0px auto; padding: 5px; border: #444444 1px solid; clear: both; font: 10px verdana; text-align: left;";
document.body.appendChild(e)}b.canvas=document.getElementsByTagName("canvas")[0];if(b.canvas)b.context=b.canvas.getContext("2d");else{b.dom=document.getElementById("canvas");b.dom.style.position="relative"}};b.start=function(d,g){function j(k,o){b.debug(o+"%: "+k,true)}function f(){b.debug("all assets loaded",true);b.gameloop=new b.GameLoop(d.setup,d.update,d.draw,h);b.gameloop.start()}if(d&&b.isFunction(d))d=new d;d||(d=window);var h=g&&g.fps||60;b.init();b.debug("setupInput()",true);b.setupInput();
b.debug("assets.loadAll()",true);b.assets.length()>0?b.assets.loadAll({loading:j,loaded:f}):f()};b.switchGameState=function(d){b.gameloop.stop();b.clearKeyCallbacks();if(b.isFunction(d))d=new d;b.previous_game_state=d;b.game_state=d;b.gameloop=new b.GameLoop(d.setup,d.update,d.draw,b.gameloop.fps);b.gameloop.start()};b.clear=function(){b.context.clearRect(0,0,b.width,b.height)};b.isImage=function(d){return Object.prototype.toString.call(d)==="[object HTMLImageElement]"};b.isCanvas=function(d){return Object.prototype.toString.call(d)===
"[object HTMLCanvasElement]"};b.isDrawable=function(d){return b.isImage(d)||b.isCanvas(d)};b.isString=function(d){return typeof d=="string"};b.isArray=function(d){return d.constructor.toString().indexOf("Array")!=-1};b.isFunction=function(d){return Object.prototype.toString.call(d)==="[object Function]"};b.combinations=function(d,g){for(var j=function(p){return d[p]},f=[],h=Array(g),k=0;k<g;k++)h[k]=k;k=g-1;for(var o=d.length;0<=k;o=d.length){for(f.push(h.map(j));0<=k&&h[k]==o-1;){k--;o--}if(0<=k){h[k]+=
1;for(k=k+1;k<g;k++)h[k]=h[k-1]+1;k=g-1}}return f};return b}(jaws||{});
jaws=function(b){var c={},e=[],d=[],g=[];b.setupInput=function(){var f=[];f[8]="backspace";f[9]="tab";f[13]="enter";f[16]="shift";f[17]="ctrl";f[18]="alt";f[19]="pause";f[20]="capslock";f[27]="esc";f[32]="space";f[33]="pageup";f[34]="pagedown";f[35]="end";f[36]="home";f[37]="left";f[38]="up";f[39]="right";f[40]="down";f[45]="insert";f[46]="delete";f[91]="leftwindowkey";f[92]="rightwindowkey";f[93]="selectkey";f[106]="multiply";f[107]="add";f[109]="subtract";f[110]="decimalpoint";f[111]="divide";f[144]=
"numlock";f[145]="scrollock";f[186]="semicolon";f[187]="equalsign";f[188]="comma";f[189]="dash";f[190]="period";f[191]="forwardslash";f[192]="graveaccent";f[219]="openbracket";f[220]="backslash";f[221]="closebracket";f[222]="singlequote";for(var h=["numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9"],k=["f1","f2","f3","f4","f5","f6","f7","f8","f9"],o=["1","2","3","4","5","6","7","8","9"],p=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r",
"s","t","u","v","w","x","y","z"],l=0;o[l];l++)f[48+l]=o[l];for(l=0;p[l];l++)f[65+l]=p[l];for(l=0;h[l];l++)f[96+l]=h[l];for(l=0;k[l];l++)f[112+l]=k[l];e=f;window.onkeydown=function(m){event=m?m:window.event;var n=e[event.keyCode];c[n]=true;if(d[n]){d[n]();m.preventDefault()}j[n]&&m.preventDefault()};window.onkeyup=function(m){event=m?m:window.event;var n=e[event.keyCode];c[n]=false;if(g[n]){g[n]();m.preventDefault()}j[n]&&m.preventDefault()};window.onkeypress=function(){}};var j=[];b.preventDefaultKeys=
function(f){f.forEach(function(h){j[h]=true})};b.pressed=function(f){return c[f]};b.on_keydown=function(f,h){if(b.isArray(f))for(var k=0;f[k];k++)d[f[k]]=h;else d[f]=h};b.on_keyup=function(f,h){if(b.isArray(f))for(var k=0;f[k];k++)g[f[k]]=h;else g[f]=h};b.clearKeyCallbacks=function(){g=[];d=[]};return b}(jaws||{});
jaws=function(b){function c(e){var d=document.createElement("canvas");d.width=e.width;d.height=e.height;d.getContext("2d").drawImage(e,0,0,e.width,e.height);return d}b.assets=new function(){this.list=[];this.data=[];e=this;this.fuchia_to_transparent=this.image_to_canvas=true;this.file_type={};this.file_type.wav="audio";this.file_type.mp3="audio";this.file_type.ogg="audio";this.file_type.png="image";this.file_type.jpg="image";this.file_type.jpeg="image";this.file_type.bmp="image";var e=this;this.length=
function(){return this.list.length};this.add=function(d){this.list.push({src:d});return this};this.get=function(d){return b.isArray(d)?d.map(function(g){return e.data[g]}):this.data[d]};this.getType=function(d){postfix_regexp=/\.([a-zA-Z]+)/;postfix=postfix_regexp.exec(d)[1];return this.file_type[postfix]?this.file_type[postfix]:postfix};this.loadAll=function(d){this.loadedCount=0;if(d){this.loaded_callback=d.loaded;this.loading_callback=d.loading}for(i=0;this.list[i];i++){d=this.list[i];switch(this.getType(d.src)){case "image":var g=
d.src+"?"+parseInt(Math.random()*1E7);d.image=new Image;d.image.asset=d;d.image.onload=this.imageLoaded;d.image.src=g;break;case "audio":g=d.src+"?"+parseInt(Math.random()*1E7);d.audio=new Audio(g);d.audio.asset=d;this.data[d.src]=d.audio;d.audio.addEventListener("canplay",this.audioLoaded,false);d.audio.load();break;default:g=d.src+"?"+parseInt(Math.random()*1E7);var j=new XMLHttpRequest;j.open("GET",g,false);j.send(null);if(j.status==200){this.data[d.src]=this.parseAsset(d.src,j.responseText);this.itemLoaded(d.src)}}}};
this.parseAsset=function(d,g){switch(this.getType(d)){case "json":return JSON.parse(g);default:return g}};this.itemLoaded=function(d){this.loadedCount++;var g=parseInt(this.loadedCount/this.list.length*100);this.loading_callback&&this.loading_callback(d,g);this.loaded_callback&&g==100&&this.loaded_callback()};this.imageLoaded=function(){var d=this.asset,g=e.image_to_canvas?c(d.image):d.image;if(e.fuchia_to_transparent){g=g;canvas=b.isImage(g)?c(g):g;g=canvas.getContext("2d");for(var j=g.getImageData(0,
0,canvas.width,canvas.height),f=j.data,h=0;h<f.length;h+=4)if(f[h]==255&&f[h+1]==0&&f[h+2]==255)f[h+3]=0;g.putImageData(j,0,0);g=canvas}e.data[d.src]=g;e.itemLoaded(d.src)};this.audioLoaded=function(){var d=this.asset;e.data[d.src]=d.audio;d.audio.removeEventListener("canplay",e.audioLoaded,false);e.itemLoaded(d.src)}};return b}(jaws||{});
jaws=function(b){b.GameLoop=function(c,e,d,g){this.fps=this.tick_duration=this.ticks=0;var j,f=false,h=this;this.start=function(){b.debug("gameloop start",true);this.current_tick=(new Date).getTime();this.last_tick=(new Date).getTime();c&&c();j=setInterval(this.loop,1E3/g);b.debug("gameloop loop",true)};this.loop=function(){h.current_tick=(new Date).getTime();h.tick_duration=h.current_tick-h.last_tick;h.fps=parseInt(1E3/h.tick_duration);if(!f){e&&e();d&&d();h.ticks++}h.last_tick=h.current_tick};this.pause=
function(){f=true};this.unpause=function(){f=false};this.stop=function(){j&&clearInterval(j)}};return b}(jaws||{});
jaws=function(b){b.Rect=function(c,e,d,g){this.x=c;this.y=e;this.width=d;this.height=g;this.__defineGetter__("right",function(){return this.x+this.width});this.__defineGetter__("bottom",function(){return this.y+this.height});this.draw=function(){b.context.strokeStyle="red";b.context.strokeRect(this.x,this.y,this.width,this.height)};this.collidePoint=function(j,f){return j>=this.x&&j<=this.right&&f>=this.y&&f<=this.bottom};this.collideRect=function(j){return(this.x>=j.x&&this.x<=j.right||j.x>=this.x&&
j.x<=this.right)&&(this.y>=j.y&&this.y<=j.bottom||j.y>=this.y&&j.y<=this.bottom)}};b.Rect.prototype.collideRightSide=function(c){return this.right>=c.x&&this.x<c.x};b.Rect.prototype.collideLeftSide=function(c){return this.x>c.x&&this.x<=c.right};b.Rect.prototype.collideTopSide=function(c){return this.y>=c.y&&this.y<=c.bottom};b.Rect.prototype.collideBottomSide=function(c){return this.bottom>=c.y&&this.y<c.y};return b}(jaws||{});
jaws=function(b){b.Sprite=function(c){this.options=c;this.x=c.x||0;this.y=c.y||0;this.alpha=c.alpha||1;this.context=c.context||b.context;this.anchor_x=c.anchor_x||0;this.anchor_y=c.anchor_y||0;this.angle=c.angle||0;this.flipped=c.flipped||false;this._scale=c.scale||1;this._rect=new b.Rect(0,0,0,0);this.__defineGetter__("width",function(){return this._width});this.__defineGetter__("height",function(){return this._height});this.__defineGetter__("left",function(){return this.x-this.left_offset});this.__defineGetter__("top",
function(){return this.y-this.top_offset});this.__defineGetter__("right",function(){return this.x+this.right_offset});this.__defineGetter__("bottom",function(){return this.y+this.bottom_offset});this.__defineGetter__("scale",function(){return this._scale});this.__defineSetter__("scale",function(e){this._scale=e;this.calcBorderOffsets()});this.__defineGetter__("image",function(){return this._image});this.__defineSetter__("image",function(e){this._image=b.isDrawable(e)?e:b.assets.data[e];this.calcBorderOffsets()});
this.__defineGetter__("rect",function(){this._rect.x=this.x-this.left_offset;this._rect.y=this.y-this.top_offset;this._rect.width=this._width;this._rect.height=this._height;return this._rect});this.calcBorderOffsets=function(){this._width=this._image.width*this._scale;this._height=this._image.height*this._scale;this.left_offset=this.width*this.anchor_x;this.top_offset=this.height*this.anchor_y;this.right_offset=this.width*(1-this.anchor_x);this.bottom_offset=this.height*(1-this.anchor_y)};c.image&&
(this.image=c.image);c.anchor&&this.anchor(c.anchor);this.context||this.createDiv()};b.Sprite.prototype.createDiv=function(){this.div=document.createElement("div");this.div.style.position="absolute";this.div.style.width=this.image.width+"px";this.div.style.height=this.image.height+"px";this.div.style.backgroundImage="url("+this.image.src+")";b.dom&&b.dom.appendChild(this.div);this.updateDiv()};b.Sprite.prototype.updateDiv=function(){this.div.style.left=this.x+"px";this.div.style.top=this.y+"px";var c=
"";c+="rotate("+this.angle+"deg) ";if(this.flipped)c+="scale(-"+this.scale+","+this.scale+")";else if(this.scale!=1)c+="scale("+this.scale+")";this.div.style.MozTransform=c;this.div.style.WebkitTransform=c;this.div.style.transform=c};b.Sprite.prototype.draw=function(){if(b.dom)return this.updateDiv();this.context.save();this.context.translate(this.x,this.y);this.angle&&b.context.rotate(this.angle*Math.PI/180);this.flipped&&this.context.scale(-1,1);this.context.globalAlpha=this.alpha;this.context.translate(-this.left_offset,
-this.top_offset);this.context.drawImage(this._image,0,0,this._width,this._height);this.context.restore();return this};b.Sprite.prototype.asCanvasContext=function(){var c=document.createElement("canvas");c.width=this.width;c.height=this.height;c=c.getContext("2d");c.mozImageSmoothingEnabled=b.context.mozImageSmoothingEnabled;c.drawImage(this._image,0,0,this.width,this.height);return c};b.Sprite.prototype.rotate=function(c){this.angle+=c;return this};b.Sprite.prototype.anchor=function(c){if(a={top_left:[0,
0],left_top:[0,0],center_left:[0,0.5],left_center:[0,0.5],bottom_left:[0,1],left_bottom:[0,1],top_center:[0.5,0],center_top:[0.5,0],center_center:[0.5,0.5],center:[0.5,0.5],bottom_center:[0.5,1],center_bottom:[0.5,1],top_right:[1,0],right_top:[1,0],center_right:[1,0.5],right_center:[1,0.5],bottom_right:[1,1],right_bottom:[1,1]}[c]){this.anchor_x=a[0];this.anchor_y=a[1];this._image&&this.calcBorderOffsets()}return this};return b}(jaws||{});
jaws=function(b){b.SpriteList=function(){};b.SpriteList.prototype=[];b.SpriteList.prototype.draw=function(){for(i=0;this[i];i++)this[i].draw()};b.SpriteList.prototype.drawIf=function(c){for(i=0;this[i];i++)c(this[i])&&this[i].draw()};b.SpriteList.prototype.update=function(){for(i=0;this[i];i++)this[i].update()};b.SpriteList.prototype.updateIf=function(c){for(i=0;this[i];i++)c(this[i])&&this[i].update()};b.SpriteList.prototype.deleteIf=function(c){for(var e=0;this[e];e++)c(this[e])&&this.splice(e,
1)};return b}(jaws||{});
jaws=function(b){function c(e,d,g,j,f){var h=document.createElement("canvas");h.width=j;h.height=f;h.getContext("2d").drawImage(e,d,g,j,f,0,0,h.width,h.height);return h}b.SpriteSheet=function(e){this.image=b.isDrawable(e.image)?e.image:b.assets.data[e.image];this.orientation=e.orientation||"right";this.frame_size=e.frame_size||[32,32];this.frames=[];for(e=0;e<this.image.width;e+=this.frame_size[0])for(var d=0;d<this.image.height;d+=this.frame_size[1])this.frames.push(c(this.image,e,d,this.frame_size[0],
this.frame_size[1]));this.__defineGetter__("length",function(){return this.frames.length})};return b}(jaws||{});
jaws=function(b){b.Parallax=function(c){this.scale=c.scale||1;this.repeat_x=c.repeat_x;this.repeat_y=c.repeat_y;this.camera_x=c.camera_x||0;this.camera_y=c.camera_y||0;this.layers=[]};b.Parallax.prototype.draw=function(){for(var c,e,d,g=0;g<this.layers.length;g++){c=this.layers[g];e=c.x;d=c.y;c.x=-(this.camera_x/c.damping);for(c.y=-(this.camera_y/c.damping);this.repeat_x&&c.x>0;)c.x-=c.image.width;for(;this.repeat_y&&c.y>0;)c.y-=c.image.width;for(;this.repeat_x&&c.x<b.width;){for(;this.repeat_y&&
c.y<b.height;){c.draw();c.y+=c.image.height}c.y=d;c.draw();c.x+=c.image.width-1}for(;c.repeat_y&&!c.repeat_x&&c.y<b.height;){c.draw();c.y+=c.image.height}c.x=e}};b.Parallax.prototype.addLayer=function(c){c=new b.ParallaxLayer(c);c.scale=this.scale;this.layers.push(c)};b.ParallaxLayer=function(c){this.damping=c.damping||0;b.Sprite.call(this,c)};b.ParallaxLayer.prototype=b.Sprite.prototype;return b}(jaws||{});
jaws=function(b){b.Animation=function(c){this.options=c;this.frames=c.frames||[];this.frame_duration=c.frame_duration||100;this.index=c.index||0;this.loop=c.loop||1;this.bounce=c.bounce||0;this.frame_direction=1;if(c.sprite_sheet){var e=b.isImage(c.sprite_sheet)?c.sprite_sheet:b.assets.get(c.sprite_sheet);this.frames=(new b.SpriteSheet({image:e,frame_size:c.frame_size})).frames}this.__defineGetter__("length",function(){return this.frames.length});this.current_tick=(new Date).getTime();this.last_tick=
(new Date).getTime();this.sum_tick=0};b.Animation.prototype.update=function(){this.current_tick=(new Date).getTime();this.sum_tick+=this.current_tick-this.last_tick;this.last_tick=this.current_tick;if(this.sum_tick>this.frame_duration){this.index+=this.frame_direction;this.sum_tick=0}if(this.index>=this.frames.length||this.index<=0)if(this.bounce){this.frame_direction=-this.frame_direction;this.index+=this.frame_direction*2}else if(this.loop)this.index=0;return this};b.Animation.prototype.slice=function(c,
e){var d={};d.frame_duration=this.frame_duration;d.loop=this.loop;d.bounce=this.bounce;d.frame_direction=this.frame_direction;d.frames=this.frames.slice().slice(c,e);return new b.Animation(d)};b.Animation.prototype.next=function(){this.update();return this.frames[this.index]};b.Animation.prototype.currentFrame=function(){return this.frames[this.index]};return b}(jaws||{});
jaws=function(b){b.Viewport=function(c){this.options=c;this.context=c.context||b.context;this.width=c.width||b.canvas.width;this.height=c.height||b.canvas.height;this.max_x=c.max_x||b.canvas.width;this.max_y=c.max_y||b.canvas.height;this._x=c.x||0;this._y=c.y||0;this.__defineGetter__("x",function(){return this._x});this.__defineGetter__("y",function(){return this._y});this.__defineSetter__("x",function(e){this._x=e;e=this.max_x-this.width;if(this._x<0)this._x=0;if(this._x>e)this._x=e});this.__defineSetter__("y",
function(e){this._y=e;e=this.max_y-this.height;if(this._y<0)this._y=0;if(this._y>e)this._y=e});this.isOutside=function(e){return!this.isInside(e)};this.isInside=function(e){return e.x>=this._x&&e.x<=this._x+this.width&&e.y>=this._y&&e.y<=this._y+this.height};this.centerAround=function(e){this.x=e.x-this.width/2;this.y=e.y-this.height/2};this.apply=function(e){this.context.save();this.context.translate(-this._x,-this._y);e();this.context.restore()}};return b}(jaws||{});
